<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ GitHub JSON</title>
</head>
<body>
  <h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
  <form id="dataForm">
    <label>‡∏ä‡∏∑‡πà‡∏≠: <input type="text" name="name" required></label><br>
    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <input type="email" name="email" required></label><br>
    <button type="submit">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>

  <pre id="status">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</pre>

  <script>
    const GITHUB_USERNAME = 'Irbeem';       // üëâ ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const REPO = 'Inspection';                      // üëâ ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const FILE_PATH = 'data.json';                 
    const TOKEN = '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';     // üî• ‡πÉ‡∏™‡πà PAT ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö public ‡∏à‡∏£‡∏¥‡∏á)
    const form = document.getElementById('dataForm');
    const status = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';

      const formData = new FormData(form);
      const newData = Object.fromEntries(formData.entries());

      const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO}/contents/${FILE_PATH}`;

      try {
        // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• data.json ‡πÄ‡∏î‡∏¥‡∏°
        const getRes = await fetch(apiUrl, {
          headers: {
            Authorization: `token ${TOKEN}`,
            Accept: 'application/vnd.github.v3+json'
          }
        });

        const fileData = await getRes.json();
        const existingContent = JSON.parse(atob(fileData.content));

        // 2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        existingContent.push(newData);
        const updatedContent = btoa(JSON.stringify(existingContent, null, 2));

        // 3. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ GitHub
        const updateRes = await fetch(apiUrl, {
          method: 'PUT',
          headers: {
            Authorization: `token ${TOKEN}`,
            Accept: 'application/vnd.github.v3+json'
          },
          body: JSON.stringify({
            message: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà',
            content: updatedContent,
            sha: fileData.sha
          })
        });

        if (updateRes.ok) {
          status.textContent = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
          form.reset();
        } else {
          const error = await updateRes.json();
          status.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + JSON.stringify(error);
        }

      } catch (err) {
        status.textContent = '‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
      }
    });
  </script>
</body>
</html>
