<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤ GitHub JSON</title>
</head>
<body>
  <h2>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
  <form id="dataForm">
    <label>‡∏ä‡∏∑‡πà‡∏≠: <input type="text" name="name" required></label><br>
    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: <input type="email" name="email" required></label><br>
    <button type="submit">üì§ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>

  <pre id="status">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</pre>

  <script>
  const GITHUB_USERNAME = 'Irbeem';
  const REPO = 'Inspection';
  const FILE_PATH = 'data.json';
  const TOKEN = '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'; // ‚ö†Ô∏è ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÄ‡∏ß‡πá‡∏ö public

  const form = document.getElementById('dataForm');
  const status = document.getElementById('status');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';

    const formData = new FormData(form);
    const newData = Object.fromEntries(formData.entries());

    const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO}/contents/${FILE_PATH}`;

    try {
      // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GitHub
      const getRes = await fetch(apiUrl, {
        headers: {
          Authorization: `token ${TOKEN}`,
          Accept: 'application/vnd.github.v3+json'
        }
      });

      if (!getRes.ok) {
        const error = await getRes.json();
        throw new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: ${error.message}`);
      }

      const fileData = await getRes.json();

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ content ‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô base64
      if (!fileData.content || fileData.encoding !== 'base64') {
        throw new Error("‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà base64");
      }

      const existingContent = JSON.parse(atob(fileData.content));
      existingContent.push(newData);
      const updatedContent = btoa(JSON.stringify(existingContent, null, 2));

      // 2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ GitHub
      const updateRes = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
          Authorization: `token ${TOKEN}`,
          Accept: 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà',
          content: updatedContent,
          sha: fileData.sha
        })
      });

      if (updateRes.ok) {
        status.textContent = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        form.reset();
      } else {
        const error = await updateRes.json();
        status.textContent = '‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + error.message;
      }

    } catch (err) {
      status.textContent = '‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
    }
  });
</script>

</body>
</html>
